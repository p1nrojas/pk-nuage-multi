# *** WARNING ***
# This file is automatically generated by build.yml.
# Changes made to this file may be overwritten.
#
---
- hosts: bmetal
  remote_user: root
  gather_facts: no
  roles:
    - webvirtmgr

- hosts: bmetal
  gather_facts: no
  remote_user: root
  tasks:

    - name: Create user webvirtmgr
      user:
        name: "webvirtmgr"
        comment: "webvirtmgr"
        group: qemu

    - name: add key of user nginx to every hypervisor
      authorized_key:
        user: webvirtmgr
        state: present
        key: "{{ lookup('file', '/tmp/' + inventory_hostname + '-nginx-webvirtmgr-id_rsa.pub') }}"

    - name: Creating 0-libvirt-remote-access.pkla file at every hypervisor
      template:
        src: '50-libvirt-remote-access.pkla.j2'
        dest: '/etc/polkit-1/localauthority/50-local.d/50-libvirt-remote-access.pkla'
        mode: 0755
