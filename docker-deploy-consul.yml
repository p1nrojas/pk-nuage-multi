# *** WARNING ***
# This file is automatically generated by build.yml.
# Changes made to this file may be overwritten.
# after installed use that way:
# docker network create --driver=nuage --ipam-driver=nuage-ipam --ipam-opt organization=ACME_Corp --ipam-opt domain=DC_domain --ipam-opt zone=DataCenter --ipam-opt subnet="Containers" --ipam-opt user=admin --subnet=192.1.60.0/24 --gateway=192.1.60.1 MyNuageNet
# docker network ls
# docker run -d -it --net MyNuageNet nginx /bin/bash

- hosts: consul
  remote_user: centos
  become: true
  become_method: sudo
  gather_facts: no
  
  tasks:
  
    - name: Pull facts on hypervisor
      action: setup
      remote_user: root
    
    - name: Install epel-release repo
      yum: name=epel-release state=present
      remote_user: root
    
    - name: yum updates
      yum: name=* state=latest
      remote_user: root
    
    - name: Install additional packages
      yum: name={{ item }} state=present
      with_items:
       - git
       - go
       - vim
      remote_user: root

    - name: Disabling selinux
      selinux:
        state: disabled
      remote_user: root

    - name: Install additional packages
      yum: name={{ item }} state=present
      with_items:
        - yum-utils 
        - device-mapper-persistent-data 
        - lvm2
      remote_user: root
          
    - name: Install docker-ce-stable yum repo
      yum_repository: 
        name: "docker-ce-stable"
        description: "Docker CE Stable - $basearch" 
        baseurl: "https://download.docker.com/linux/centos/7/$basearch/stable"
        gpgkey: "https://download.docker.com/linux/centos/gpg"
        gpgcheck: yes
        state: present
      remote_user: root

    - name: Ensure the yum package index is up to Date
      yum:
        update_cache: yes
        name: '*'
        state: latest
      remote_user: root

    - name: Install docker-ce packages
      yum: name=docker-ce state=present
      remote_user: root
    
    - file:
        path: /etc/docker
        state: directory
      remote_user: root

    - name: create /etc/docker/daemon.json
      template:
        src: daemon.json.j2
        dest: /etc/docker/daemon.json
      remote_user: root

    - name: Check docker service is running
      service:
        name: docker
        state: started 
      remote_user: root

    - name: run docker consul
      shell: "docker run -d -p 8400:8400 -p 8500:8500 -p 8600:53/udp -h node1 progrium/consul -server -bootstrap"
      remote_user: root
     
